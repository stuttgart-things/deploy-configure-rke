---
name: deploy_rke
namespace: sthings
requirements: |
  roles:
    - src: https://github.com/stuttgart-things/deploy-configure-rke.git
      scm: git
      version: main
    - src: https://github.com/stuttgart-things/configure-rke-node.git
      scm: git
      version: main
    - src: https://github.com/stuttgart-things/install-requirements.git
      scm: git
      version: main
    - src: https://github.com/stuttgart-things/install-configure-docker.git
      scm: git
      version: main
    - src: https://github.com/stuttgart-things/create-os-user.git
      scm: git
      version: main
    - src: https://github.com/stuttgart-things/download-install-binary.git
      scm: git
      version: main

playbooks:
  - name: rke1
    play: |
      - hosts: all
        become: true

        vars:
          rke_docker_version: '=5:23.0.6-1~ubuntu.22.04~jammy'
          rke_docker_ce_version: '5:23.0.6*'
          rke_version: 1
          rke_user_name: rke
          rke_installer_version: 1.4.8
          rke_kubernetes_version: v1.26.7-rancher1-1
          project_folder: rancher-things
          rke_create_rke_user: true
          network_plugin: calico
          rke2_airgapped_installation: false

        roles:
          - role: deploy-configure-rke
          
  - name: rke2
    play: |
      - hosts: all
        become: true

        vars:
          rke_version: 2
          rke2_k8s_version: 1.26.0
          rke2_airgapped_installation: true
          rke2_release_kind: rke2r2 # rke2r1
          disable_rke2_components:
            - rke2-ingress-nginx
            - rke-snapshot-controller
          cluster_setup: multinode
          install_containerd: false # bring your own containerd
          containerdRootPath: /var/lib/containerd/ # directory must not exist

        roles:
          - role: deploy-configure-rke
          
